<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a0a0f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Everest">
<meta name="description" content="M√©todo Everest ‚Äî Rotina de Alta Performance">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<title>M√©todo Everest</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,700;1,300&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #0a0a0f;
  --bg2: #12121a;
  --bg3: #1a1a26;
  --surface: #1e1e2e;
  --border: rgba(255,255,255,0.07);
  --gold: #d4a853;
  --gold-dim: rgba(212,168,83,0.15);
  --gold-glow: rgba(212,168,83,0.3);
  --ice: #7eb8d4;
  --green: #4caf7d;
  --red: #e05252;
  --text: #eeeef0;
  --text-2: #9999aa;
  --text-3: #55556a;
  --font-display: 'Bebas Neue', sans-serif;
  --font-body: 'DM Sans', sans-serif;
  --font-mono: 'DM Mono', monospace;
  --radius: 12px;
  --nav-h: 68px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

html, body { height: 100%; overflow: hidden; background: var(--bg); }

body {
  font-family: var(--font-body);
  color: var(--text);
  overscroll-behavior: none;
}

/* ‚îÄ‚îÄ NOISE OVERLAY ‚îÄ‚îÄ */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 9999;
}

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
.screen { display: none; position: fixed; inset: 0; overflow-y: auto; overscroll-behavior: contain; }
.screen.active { display: block; }

/* ‚îÄ‚îÄ LOGIN SCREEN ‚îÄ‚îÄ */
#screen-login {
  background: var(--bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 24px;
  min-height: 100vh;
}
#screen-login.active { display: flex; }

.login-logo {
  font-family: var(--font-display);
  font-size: 72px;
  letter-spacing: 6px;
  color: var(--gold);
  line-height: 1;
  text-align: center;
  position: relative;
}
.login-logo::after {
  content: '';
  display: block;
  width: 48px;
  height: 3px;
  background: var(--gold);
  margin: 12px auto 0;
}
.login-sub {
  font-family: var(--font-mono);
  font-size: 11px;
  letter-spacing: 0.2em;
  color: var(--text-3);
  text-transform: uppercase;
  text-align: center;
  margin-top: 20px;
  margin-bottom: 52px;
}

.login-card {
  width: 100%;
  max-width: 380px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px 28px;
}

.login-tabs {
  display: flex;
  gap: 4px;
  background: var(--bg3);
  border-radius: 8px;
  padding: 4px;
  margin-bottom: 28px;
}
.login-tab {
  flex: 1;
  padding: 8px;
  text-align: center;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-2);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}
.login-tab.active { background: var(--gold); color: #000; font-weight: 700; }

.form-group { margin-bottom: 16px; }
.form-label {
  display: block;
  font-size: 12px;
  font-weight: 500;
  color: var(--text-2);
  letter-spacing: 0.05em;
  margin-bottom: 6px;
  text-transform: uppercase;
}
.form-input {
  width: 100%;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 14px;
  font-size: 15px;
  font-family: var(--font-body);
  color: var(--text);
  outline: none;
  transition: border-color 0.2s;
}
.form-input:focus { border-color: var(--gold); }
.form-input::placeholder { color: var(--text-3); }

.btn-primary {
  width: 100%;
  padding: 14px;
  background: var(--gold);
  color: #000;
  font-family: var(--font-display);
  font-size: 20px;
  letter-spacing: 2px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 8px;
}
.btn-primary:hover { background: #e8bf6a; transform: translateY(-1px); }
.btn-primary:active { transform: translateY(0); }

.form-error {
  color: var(--red);
  font-size: 12px;
  margin-top: 12px;
  text-align: center;
  min-height: 16px;
}

/* ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ */
#screen-app {
  background: var(--bg);
  padding-bottom: var(--nav-h);
}
#screen-app.active { display: block; }

/* ‚îÄ‚îÄ TOP HEADER ‚îÄ‚îÄ */
.app-header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(10,10,15,0.92);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 14px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.header-logo {
  font-family: var(--font-display);
  font-size: 28px;
  letter-spacing: 3px;
  color: var(--gold);
}
.header-right { display: flex; align-items: center; gap: 12px; }
.header-streak {
  display: flex;
  align-items: center;
  gap: 6px;
  background: var(--gold-dim);
  border: 1px solid var(--gold-glow);
  border-radius: 20px;
  padding: 5px 12px;
  font-family: var(--font-mono);
  font-size: 13px;
  font-weight: 500;
  color: var(--gold);
}
.btn-logout {
  background: none;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 6px 10px;
  color: var(--text-3);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-logout:hover { border-color: var(--red); color: var(--red); }

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: var(--nav-h);
  background: rgba(18,18,26,0.96);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-top: 1px solid var(--border);
  display: flex;
  z-index: 100;
  padding-bottom: env(safe-area-inset-bottom);
}
.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  cursor: pointer;
  transition: all 0.2s;
  padding: 8px 0;
  position: relative;
}
.nav-item .nav-icon { font-size: 22px; transition: transform 0.2s; }
.nav-item .nav-label { font-size: 10px; font-weight: 500; color: var(--text-3); letter-spacing: 0.05em; text-transform: uppercase; transition: color 0.2s; }
.nav-item.active .nav-label { color: var(--gold); }
.nav-item.active .nav-icon { transform: translateY(-2px); }
.nav-item.active::after {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 32px;
  height: 2px;
  background: var(--gold);
  border-radius: 0 0 2px 2px;
}

/* ‚îÄ‚îÄ PAGE CONTAINERS ‚îÄ‚îÄ */
.page { display: none; padding: 20px 20px 16px; animation: fadeIn 0.3s ease; }
.page.active { display: block; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

/* ‚îÄ‚îÄ HOME / DASHBOARD ‚îÄ‚îÄ */
.greeting {
  margin-bottom: 24px;
}
.greeting-time {
  font-family: var(--font-mono);
  font-size: 11px;
  letter-spacing: 0.15em;
  color: var(--text-3);
  text-transform: uppercase;
  margin-bottom: 4px;
}
.greeting-name {
  font-family: var(--font-display);
  font-size: 36px;
  letter-spacing: 2px;
  color: var(--text);
  line-height: 1;
}
.greeting-name span { color: var(--gold); }

/* Daily Score Ring */
.score-ring-container {
  display: flex;
  align-items: center;
  gap: 20px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
}
.score-ring-container::before {
  content: '';
  position: absolute;
  top: -40px; right: -40px;
  width: 120px; height: 120px;
  background: radial-gradient(circle, var(--gold-glow), transparent 70%);
  pointer-events: none;
}
.ring-wrap { position: relative; width: 80px; height: 80px; flex-shrink: 0; }
.ring-wrap svg { transform: rotate(-90deg); }
.ring-bg { fill: none; stroke: var(--bg3); stroke-width: 6; }
.ring-fill { fill: none; stroke: var(--gold); stroke-width: 6; stroke-linecap: round; stroke-dasharray: 220; stroke-dashoffset: 220; transition: stroke-dashoffset 1s cubic-bezier(0.25,1,0.5,1); }
.ring-text {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.ring-pct { font-family: var(--font-display); font-size: 22px; color: var(--gold); line-height: 1; }
.ring-pct-label { font-size: 9px; color: var(--text-3); letter-spacing: 0.1em; }
.score-info { flex: 1; }
.score-title { font-weight: 700; font-size: 15px; margin-bottom: 4px; }
.score-sub { font-size: 13px; color: var(--text-2); line-height: 1.5; }

/* Pilar Cards Grid */
.pilares-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 20px;
}
.pilar-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.pilar-card:hover { border-color: rgba(255,255,255,0.15); transform: translateY(-2px); }
.pilar-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
}
.pilar-card[data-pilar="sono"]::before { background: linear-gradient(90deg, #7eb8d4, transparent); }
.pilar-card[data-pilar="alimentacao"]::before { background: linear-gradient(90deg, #4caf7d, transparent); }
.pilar-card[data-pilar="biohacking"]::before { background: linear-gradient(90deg, #d4a853, transparent); }
.pilar-card[data-pilar="treino"]::before { background: linear-gradient(90deg, #e05252, transparent); }

.pilar-emoji { font-size: 24px; margin-bottom: 8px; }
.pilar-name { font-size: 11px; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-2); margin-bottom: 6px; }
.pilar-progress-bar { height: 3px; background: var(--bg3); border-radius: 2px; overflow: hidden; }
.pilar-progress-fill { height: 100%; border-radius: 2px; transition: width 0.8s cubic-bezier(0.25,1,0.5,1); }
.pilar-card[data-pilar="sono"] .pilar-progress-fill { background: #7eb8d4; }
.pilar-card[data-pilar="alimentacao"] .pilar-progress-fill { background: #4caf7d; }
.pilar-card[data-pilar="biohacking"] .pilar-progress-fill { background: var(--gold); }
.pilar-card[data-pilar="treino"] .pilar-progress-fill { background: var(--red); }
.pilar-done { font-family: var(--font-mono); font-size: 10px; color: var(--text-3); margin-top: 6px; }

/* Streak section */
.section-title {
  font-family: var(--font-mono);
  font-size: 11px;
  letter-spacing: 0.2em;
  color: var(--text-3);
  text-transform: uppercase;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }

.streak-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
  margin-bottom: 20px;
}
.streak-day {
  aspect-ratio: 1;
  border-radius: 6px;
  background: var(--bg3);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
}
.streak-day.done { background: var(--gold-dim); border: 1px solid var(--gold-glow); }
.streak-day.today { border: 2px solid var(--gold); }
.streak-day-label { font-size: 8px; color: var(--text-3); letter-spacing: 0.05em; text-transform: uppercase; }
.streak-day-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--bg); }
.streak-day.done .streak-day-dot { background: var(--gold); }

/* ‚îÄ‚îÄ CHECKLIST PAGE ‚îÄ‚îÄ */
.checklist-date {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-3);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-bottom: 20px;
}

.pilar-section { margin-bottom: 28px; }
.pilar-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--border);
}
.pilar-header-emoji { font-size: 18px; }
.pilar-header-name { font-family: var(--font-display); font-size: 22px; letter-spacing: 1px; }
.pilar-header-count { margin-left: auto; font-family: var(--font-mono); font-size: 11px; color: var(--text-3); }

.check-item {
  display: flex;
  align-items: flex-start;
  gap: 14px;
  padding: 14px;
  border-radius: 10px;
  border: 1px solid transparent;
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.2s;
  background: var(--surface);
}
.check-item:hover { border-color: var(--border); }
.check-item.done { background: rgba(212,168,83,0.06); border-color: rgba(212,168,83,0.2); }

.check-box {
  width: 24px;
  height: 24px;
  border-radius: 6px;
  border: 2px solid var(--text-3);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  margin-top: 1px;
}
.check-item.done .check-box { background: var(--gold); border-color: var(--gold); }
.check-tick { opacity: 0; transition: opacity 0.15s; font-size: 13px; color: #000; }
.check-item.done .check-tick { opacity: 1; }

.check-content { flex: 1; }
.check-title { font-weight: 600; font-size: 14px; margin-bottom: 3px; line-height: 1.3; }
.check-item.done .check-title { color: var(--text-2); }
.check-desc { font-size: 12px; color: var(--text-2); line-height: 1.5; }
.check-tag {
  font-family: var(--font-mono);
  font-size: 9px;
  letter-spacing: 0.1em;
  padding: 2px 7px;
  border-radius: 4px;
  display: inline-block;
  margin-top: 6px;
}

/* ‚îÄ‚îÄ PROGRESSO PAGE ‚îÄ‚îÄ */
.stats-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
  margin-bottom: 20px;
}
.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px 12px;
  text-align: center;
}
.stat-value { font-family: var(--font-display); font-size: 32px; color: var(--gold); line-height: 1; }
.stat-label { font-size: 11px; color: var(--text-2); margin-top: 4px; line-height: 1.3; }

.weekly-chart { margin-bottom: 20px; }
.chart-bars {
  display: flex;
  align-items: flex-end;
  gap: 6px;
  height: 80px;
  padding: 0 4px;
  margin-bottom: 6px;
}
.chart-bar-wrap {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  height: 100%;
  justify-content: flex-end;
}
.chart-bar {
  width: 100%;
  background: var(--gold);
  border-radius: 4px 4px 0 0;
  min-height: 4px;
  transition: height 0.8s cubic-bezier(0.25,1,0.5,1);
  opacity: 0.7;
}
.chart-bar.today { opacity: 1; box-shadow: 0 0 12px var(--gold-glow); }
.chart-day-label { font-size: 9px; color: var(--text-3); text-align: center; }

.pilar-breakdown { margin-bottom: 20px; }
.breakdown-item {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 14px;
}
.breakdown-emoji { font-size: 18px; width: 28px; text-align: center; }
.breakdown-info { flex: 1; }
.breakdown-name { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
.breakdown-bar { height: 5px; background: var(--bg3); border-radius: 3px; overflow: hidden; }
.breakdown-fill { height: 100%; border-radius: 3px; transition: width 0.8s cubic-bezier(0.25,1,0.5,1); }
.breakdown-pct { font-family: var(--font-mono); font-size: 12px; color: var(--text-2); width: 36px; text-align: right; }

/* ‚îÄ‚îÄ PERFIL PAGE ‚îÄ‚îÄ */
.profile-avatar {
  width: 72px;
  height: 72px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--gold), #8a5f12);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-display);
  font-size: 32px;
  color: #000;
  margin: 0 auto 16px;
  letter-spacing: 1px;
}
.profile-name-display {
  font-family: var(--font-display);
  font-size: 28px;
  letter-spacing: 2px;
  text-align: center;
  margin-bottom: 4px;
}
.profile-email { font-size: 13px; color: var(--text-2); text-align: center; margin-bottom: 28px; }

.settings-group { margin-bottom: 24px; }
.settings-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-bottom: 8px;
  cursor: pointer;
  transition: border-color 0.2s;
}
.settings-item:hover { border-color: rgba(255,255,255,0.15); }
.settings-item-left { display: flex; align-items: center; gap: 12px; }
.settings-icon { font-size: 18px; }
.settings-label { font-size: 14px; font-weight: 500; }
.settings-arrow { color: var(--text-3); font-size: 16px; }

.toggle {
  width: 44px;
  height: 24px;
  background: var(--bg3);
  border-radius: 12px;
  position: relative;
  cursor: pointer;
  transition: background 0.2s;
  border: none;
  outline: none;
}
.toggle.on { background: var(--gold); }
.toggle::after {
  content: '';
  position: absolute;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: white;
  top: 3px; left: 3px;
  transition: transform 0.2s;
}
.toggle.on::after { transform: translateX(20px); }

/* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-3);
}
.empty-state-icon { font-size: 40px; margin-bottom: 12px; }
.empty-state-text { font-size: 14px; line-height: 1.6; }

/* Scrollbar */
::-webkit-scrollbar { width: 0; }

/* Toast */
.toast {
  position: fixed;
  bottom: calc(var(--nav-h) + 16px);
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: var(--surface);
  border: 1px solid var(--gold-glow);
  border-radius: 20px;
  padding: 10px 20px;
  font-size: 13px;
  font-weight: 500;
  color: var(--gold);
  opacity: 0;
  transition: all 0.3s;
  z-index: 9998;
  white-space: nowrap;
  pointer-events: none;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<!-- ‚ïê‚ïê LOGIN SCREEN ‚ïê‚ïê -->
<div id="screen-login" class="screen active">
  <div class="login-logo">EVEREST</div>
  <div class="login-sub">Rotina de Alta Performance</div>

  <div class="login-card">
    <div class="login-tabs">
      <div class="login-tab active" onclick="switchTab('login')">Entrar</div>
      <div class="login-tab" onclick="switchTab('register')">Criar Conta</div>
    </div>

    <div id="tab-login">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-input" type="email" id="login-email" placeholder="seu@email.com" autocomplete="email">
      </div>
      <div class="form-group">
        <label class="form-label">Senha</label>
        <input class="form-input" type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
      </div>
      <button class="btn-primary" onclick="doLogin()">ACESSAR</button>
      <div class="form-error" id="login-error"></div>
    </div>

    <div id="tab-register" style="display:none">
      <div class="form-group">
        <label class="form-label">Nome</label>
        <input class="form-input" type="text" id="reg-name" placeholder="Seu nome">
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-input" type="email" id="reg-email" placeholder="seu@email.com" autocomplete="email">
      </div>
      <div class="form-group">
        <label class="form-label">Senha</label>
        <input class="form-input" type="password" id="reg-password" placeholder="M√≠nimo 6 caracteres" autocomplete="new-password">
      </div>
      <button class="btn-primary" onclick="doRegister()">CRIAR CONTA</button>
      <div class="form-error" id="reg-error"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê APP SCREEN ‚ïê‚ïê -->
<div id="screen-app" class="screen">

  <!-- Header -->
  <div class="app-header">
    <div class="header-logo">EVEREST</div>
    <div class="header-right">
      <div class="header-streak">üî• <span id="header-streak-count">0</span> dias</div>
      <button class="btn-logout" onclick="doLogout()">Sair</button>
    </div>
  </div>

  <!-- Pages -->

  <!-- HOME -->
  <div id="page-home" class="page active">
    <div class="greeting">
      <div class="greeting-time" id="greeting-time">Bom dia</div>
      <div class="greeting-name">Ol√°, <span id="greeting-name">Atleta</span></div>
    </div>

    <div class="score-ring-container">
      <div class="ring-wrap">
        <svg width="80" height="80" viewBox="0 0 80 80">
          <circle class="ring-bg" cx="40" cy="40" r="35"/>
          <circle class="ring-fill" id="ring-fill" cx="40" cy="40" r="35"/>
        </svg>
        <div class="ring-text">
          <div class="ring-pct" id="ring-pct">0%</div>
          <div class="ring-pct-label">HOJE</div>
        </div>
      </div>
      <div class="score-info">
        <div class="score-title" id="score-title">Inicie seu dia</div>
        <div class="score-sub" id="score-sub">Complete os protocolos de hoje para subir sua pontua√ß√£o.</div>
      </div>
    </div>

    <div class="section-title">Pilares de hoje</div>
    <div class="pilares-grid">
      <div class="pilar-card" data-pilar="sono" onclick="goToChecklist('sono')">
        <div class="pilar-emoji">üåô</div>
        <div class="pilar-name">Sono</div>
        <div class="pilar-progress-bar"><div class="pilar-progress-fill" id="prog-sono" style="width:0%"></div></div>
        <div class="pilar-done" id="done-sono">0/4</div>
      </div>
      <div class="pilar-card" data-pilar="alimentacao" onclick="goToChecklist('alimentacao')">
        <div class="pilar-emoji">ü•©</div>
        <div class="pilar-name">Alimenta√ß√£o</div>
        <div class="pilar-progress-bar"><div class="pilar-progress-fill" id="prog-alimentacao" style="width:0%"></div></div>
        <div class="pilar-done" id="done-alimentacao">0/4</div>
      </div>
      <div class="pilar-card" data-pilar="biohacking" onclick="goToChecklist('biohacking')">
        <div class="pilar-emoji">‚ö°</div>
        <div class="pilar-name">Biohacking</div>
        <div class="pilar-progress-bar"><div class="pilar-progress-fill" id="prog-biohacking" style="width:0%"></div></div>
        <div class="pilar-done" id="done-biohacking">0/4</div>
      </div>
      <div class="pilar-card" data-pilar="treino" onclick="goToChecklist('treino')">
        <div class="pilar-emoji">üèîÔ∏è</div>
        <div class="pilar-name">Treino</div>
        <div class="pilar-progress-bar"><div class="pilar-progress-fill" id="prog-treino" style="width:0%"></div></div>
        <div class="pilar-done" id="done-treino">0/3</div>
      </div>
    </div>

    <div class="section-title">√öltimos 7 dias</div>
    <div class="streak-grid" id="streak-grid"></div>
  </div>

  <!-- CHECKLIST -->
  <div id="page-checklist" class="page">
    <div class="checklist-date" id="checklist-date"></div>

    <!-- SONO -->
    <div class="pilar-section" id="section-sono">
      <div class="pilar-header">
        <span class="pilar-header-emoji">üåô</span>
        <span class="pilar-header-name" style="color:#7eb8d4">SONO</span>
        <span class="pilar-header-count" id="count-sono">0/4</span>
      </div>
      <div class="check-item" data-key="sono-0" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Dormi 7‚Äì9 horas</div>
          <div class="check-desc">Mantive hor√°rio consistente de dormir e acordar</div>
          <span class="check-tag" style="background:rgba(126,184,212,0.1);color:#7eb8d4">Ritmo circadiano</span>
        </div>
      </div>
      <div class="check-item" data-key="sono-1" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Luz solar nos primeiros 30 min</div>
          <div class="check-desc">Exposi√ß√£o √† luz natural ap√≥s acordar para ancorar ritmo circadiano</div>
          <span class="check-tag" style="background:rgba(126,184,212,0.1);color:#7eb8d4">Huberman Protocol</span>
        </div>
      </div>
      <div class="check-item" data-key="sono-2" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Sem tela 1h antes de dormir</div>
          <div class="check-desc">Luz azul suprime melatonina ‚Äî bloqueio preserva qualidade do sono</div>
          <span class="check-tag" style="background:rgba(126,184,212,0.1);color:#7eb8d4">Melatonina</span>
        </div>
      </div>
      <div class="check-item" data-key="sono-3" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Sem cafe√≠na ap√≥s 14h</div>
          <div class="check-desc">Meia-vida de 5‚Äì7h ‚Äî cafe√≠na √†s 15h ainda atua √†s 20h</div>
          <span class="check-tag" style="background:rgba(126,184,212,0.1);color:#7eb8d4">Adenosina</span>
        </div>
      </div>
    </div>

    <!-- ALIMENTA√á√ÉO -->
    <div class="pilar-section" id="section-alimentacao">
      <div class="pilar-header">
        <span class="pilar-header-emoji">ü•©</span>
        <span class="pilar-header-name" style="color:#4caf7d">ALIMENTA√á√ÉO</span>
        <span class="pilar-header-count" id="count-alimentacao">0/4</span>
      </div>
      <div class="check-item" data-key="alimentacao-0" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Meta de prote√≠na atingida</div>
          <div class="check-desc">1.6‚Äì2.2g por kg de peso corporal ‚Äî base da recupera√ß√£o e cogni√ß√£o</div>
          <span class="check-tag" style="background:rgba(76,175,125,0.1);color:#4caf7d">S√≠ntese muscular</span>
        </div>
      </div>
      <div class="check-item" data-key="alimentacao-1" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Janela alimentar respeitada</div>
          <div class="check-desc">Time-Restricted Eating: comer em janela de 8‚Äì10h do dia</div>
          <span class="check-tag" style="background:rgba(76,175,125,0.1);color:#4caf7d">Metabolismo</span>
        </div>
      </div>
      <div class="check-item" data-key="alimentacao-2" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">3L de √°gua ou mais</div>
          <div class="check-desc">Desidrata√ß√£o de 2% compromete for√ßa e cogni√ß√£o em at√© 8%</div>
          <span class="check-tag" style="background:rgba(76,175,125,0.1);color:#4caf7d">Hidrata√ß√£o</span>
        </div>
      </div>
      <div class="check-item" data-key="alimentacao-3" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Suplementa√ß√£o b√°sica</div>
          <div class="check-desc">Creatina (3‚Äì5g) + √îmega-3 (2‚Äì4g EPA+DHA)</div>
          <span class="check-tag" style="background:rgba(76,175,125,0.1);color:#4caf7d">Suplementos</span>
        </div>
      </div>
    </div>

    <!-- BIOHACKING -->
    <div class="pilar-section" id="section-biohacking">
      <div class="pilar-header">
        <span class="pilar-header-emoji">‚ö°</span>
        <span class="pilar-header-name" style="color:#d4a853">BIOHACKING</span>
        <span class="pilar-header-count" id="count-biohacking">0/4</span>
      </div>
      <div class="check-item" data-key="biohacking-0" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Banho frio (1‚Äì3 min)</div>
          <div class="check-desc">√Ågua ‚â§15¬∞C aumenta norepinefrina, melhora humor e recupera√ß√£o</div>
          <span class="check-tag" style="background:rgba(212,168,83,0.1);color:#d4a853">Cold Exposure</span>
        </div>
      </div>
      <div class="check-item" data-key="biohacking-1" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Respira√ß√£o c√≠clica (5 min)</div>
          <div class="check-desc">Box Breathing 4-4-4-4: regula SN aut√¥nomo, reduz cortisol</div>
          <span class="check-tag" style="background:rgba(212,168,83,0.1);color:#d4a853">Sistema Nervoso</span>
        </div>
      </div>
      <div class="check-item" data-key="biohacking-2" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">NSDR / Descanso profundo</div>
          <div class="check-desc">10‚Äì20 min de relaxamento sem dormir ‚Äî restaura dopamina e aprendizado</div>
          <span class="check-tag" style="background:rgba(212,168,83,0.1);color:#d4a853">NSDR Protocol</span>
        </div>
      </div>
      <div class="check-item" data-key="biohacking-3" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Jejum cognitivo matinal</div>
          <div class="check-desc">Primeiras 4‚Äì6h sem glicose ‚Äî eleva BDNF e foco via cetose leve</div>
          <span class="check-tag" style="background:rgba(212,168,83,0.1);color:#d4a853">BDNF</span>
        </div>
      </div>
    </div>

    <!-- TREINO -->
    <div class="pilar-section" id="section-treino">
      <div class="pilar-header">
        <span class="pilar-header-emoji">üèîÔ∏è</span>
        <span class="pilar-header-name" style="color:#e05252">TREINO</span>
        <span class="pilar-header-count" id="count-treino">0/3</span>
      </div>
      <div class="check-item" data-key="treino-0" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Treino realizado</div>
          <div class="check-desc">For√ßa 3‚Äì4x/sem ou cardio zona 2 ‚Äî 20‚Äì45 min m√≠nimo</div>
          <span class="check-tag" style="background:rgba(224,82,82,0.1);color:#e05252">Consist√™ncia</span>
        </div>
      </div>
      <div class="check-item" data-key="treino-1" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Progress√£o registrada</div>
          <div class="check-desc">Anotei cargas ou volume para rastrear evolu√ß√£o objetiva</div>
          <span class="check-tag" style="background:rgba(224,82,82,0.1);color:#e05252">Progressive Overload</span>
        </div>
      </div>
      <div class="check-item" data-key="treino-2" onclick="toggleCheck(this)">
        <div class="check-box"><span class="check-tick">‚úì</span></div>
        <div class="check-content">
          <div class="check-title">Mobilidade / recupera√ß√£o</div>
          <div class="check-desc">10‚Äì15 min de alongamento ou mobilidade ativa</div>
          <span class="check-tag" style="background:rgba(224,82,82,0.1);color:#e05252">Recupera√ß√£o</span>
        </div>
      </div>
    </div>
  </div>

  <!-- PROGRESSO -->
  <div id="page-progresso" class="page">
    <div class="greeting-time" style="margin-bottom:16px">Sua evolu√ß√£o</div>

    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-value" id="stat-streak">0</div>
        <div class="stat-label">Dias de streak</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-total">0</div>
        <div class="stat-label">Dias completados</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-avg">0%</div>
        <div class="stat-label">M√©dia semanal</div>
      </div>
    </div>

    <div class="section-title">√öltimas 2 semanas</div>
    <div class="weekly-chart">
      <div class="chart-bars" id="chart-bars"></div>
    </div>

    <div class="section-title">Por pilar (semana)</div>
    <div class="pilar-breakdown">
      <div class="breakdown-item">
        <span class="breakdown-emoji">üåô</span>
        <div class="breakdown-info">
          <div class="breakdown-name">Sono</div>
          <div class="breakdown-bar"><div class="breakdown-fill" id="bd-sono" style="width:0%;background:#7eb8d4"></div></div>
        </div>
        <span class="breakdown-pct" id="bdp-sono">0%</span>
      </div>
      <div class="breakdown-item">
        <span class="breakdown-emoji">ü•©</span>
        <div class="breakdown-info">
          <div class="breakdown-name">Alimenta√ß√£o</div>
          <div class="breakdown-bar"><div class="breakdown-fill" id="bd-alimentacao" style="width:0%;background:#4caf7d"></div></div>
        </div>
        <span class="breakdown-pct" id="bdp-alimentacao">0%</span>
      </div>
      <div class="breakdown-item">
        <span class="breakdown-emoji">‚ö°</span>
        <div class="breakdown-info">
          <div class="breakdown-name">Biohacking</div>
          <div class="breakdown-bar"><div class="breakdown-fill" id="bd-biohacking" style="width:0%;background:#d4a853"></div></div>
        </div>
        <span class="breakdown-pct" id="bdp-biohacking">0%</span>
      </div>
      <div class="breakdown-item">
        <span class="breakdown-emoji">üèîÔ∏è</span>
        <div class="breakdown-info">
          <div class="breakdown-name">Treino</div>
          <div class="breakdown-bar"><div class="breakdown-fill" id="bd-treino" style="width:0%;background:#e05252"></div></div>
        </div>
        <span class="breakdown-pct" id="bdp-treino">0%</span>
      </div>
    </div>
  </div>

  <!-- PERFIL -->
  <div id="page-perfil" class="page">
    <div class="profile-avatar" id="profile-avatar">E</div>
    <div class="profile-name-display" id="profile-name-display">Atleta</div>
    <div class="profile-email" id="profile-email-display">‚Äî</div>

    <div class="section-title">Configura√ß√µes</div>
    <div class="settings-group">
      <div class="settings-item">
        <div class="settings-item-left">
          <span class="settings-icon">üîî</span>
          <span class="settings-label">Notifica√ß√µes</span>
        </div>
        <button class="toggle on" id="toggle-notif" onclick="toggleSetting('notif', this)"></button>
      </div>
      <div class="settings-item">
        <div class="settings-item-left">
          <span class="settings-icon">üåô</span>
          <span class="settings-label">Lembrete noturno (22h)</span>
        </div>
        <button class="toggle on" id="toggle-night" onclick="toggleSetting('night', this)"></button>
      </div>
    </div>

    <div class="section-title">Conta</div>
    <div class="settings-group">
      <div class="settings-item" onclick="doLogout()">
        <div class="settings-item-left">
          <span class="settings-icon">üö™</span>
          <span class="settings-label" style="color:#e05252">Sair da conta</span>
        </div>
        <span class="settings-arrow">‚Üí</span>
      </div>
      <div class="settings-item" onclick="clearData()">
        <div class="settings-item-left">
          <span class="settings-icon">üóëÔ∏è</span>
          <span class="settings-label" style="color:#e05252">Resetar dados</span>
        </div>
        <span class="settings-arrow">‚Üí</span>
      </div>
    </div>

    <div style="text-align:center;margin-top:32px">
      <div style="font-family:var(--font-display);font-size:24px;letter-spacing:3px;color:var(--gold);margin-bottom:4px">EVEREST</div>
      <div style="font-size:11px;color:var(--text-3);font-family:var(--font-mono)">MVP v1.0 ‚Äî M√©todo Everest</div>
    </div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <div class="nav-item active" id="nav-home" onclick="navigate('home')">
      <span class="nav-icon">üè†</span>
      <span class="nav-label">In√≠cio</span>
    </div>
    <div class="nav-item" id="nav-checklist" onclick="navigate('checklist')">
      <span class="nav-icon">‚úÖ</span>
      <span class="nav-label">Hoje</span>
    </div>
    <div class="nav-item" id="nav-progresso" onclick="navigate('progresso')">
      <span class="nav-icon">üìà</span>
      <span class="nav-label">Progresso</span>
    </div>
    <div class="nav-item" id="nav-perfil" onclick="navigate('perfil')">
      <span class="nav-icon">üë§</span>
      <span class="nav-label">Perfil</span>
    </div>
  </nav>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA LAYER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const PILARES = {
  sono: { total: 4 },
  alimentacao: { total: 4 },
  biohacking: { total: 4 },
  treino: { total: 3 }
};

const TOTAL_CHECKS = 15;

function getDB() {
  try { return JSON.parse(localStorage.getItem('everest_db') || '{}'); } catch { return {}; }
}
function saveDB(db) {
  try { localStorage.setItem('everest_db', JSON.stringify(db)); } catch {}
}

function getUsers() {
  const db = getDB();
  return db.users || {};
}
function saveUsers(users) {
  const db = getDB();
  db.users = users;
  saveDB(db);
}

function getCurrentUser() {
  try { return JSON.parse(localStorage.getItem('everest_user') || 'null'); } catch { return null; }
}
function setCurrentUser(user) {
  localStorage.setItem('everest_user', JSON.stringify(user));
}
function clearCurrentUser() {
  localStorage.removeItem('everest_user');
}

function getUserData(email) {
  const db = getDB();
  return (db.userData || {})[email] || { checks: {}, settings: { notif: true, night: true } };
}
function saveUserData(email, data) {
  const db = getDB();
  if (!db.userData) db.userData = {};
  db.userData[email] = data;
  saveDB(db);
}

function getTodayKey() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

function getTodayChecks() {
  const user = getCurrentUser();
  if (!user) return {};
  const data = getUserData(user.email);
  return data.checks[getTodayKey()] || {};
}

function setCheck(key, value) {
  const user = getCurrentUser();
  if (!user) return;
  const data = getUserData(user.email);
  const today = getTodayKey();
  if (!data.checks[today]) data.checks[today] = {};
  data.checks[today][key] = value;
  saveUserData(user.email, data);
}

function getDayChecks(dateKey) {
  const user = getCurrentUser();
  if (!user) return {};
  const data = getUserData(user.email);
  return data.checks[dateKey] || {};
}

function getDayScore(dateKey) {
  const checks = getDayChecks(dateKey);
  const done = Object.values(checks).filter(Boolean).length;
  return Math.round((done / TOTAL_CHECKS) * 100);
}

function getStreak() {
  const user = getCurrentUser();
  if (!user) return 0;
  let streak = 0;
  const d = new Date();
  // don't count today in streak unless complete
  d.setDate(d.getDate() - 1);
  for (let i = 0; i < 365; i++) {
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const score = getDayScore(key);
    if (score >= 60) { streak++; d.setDate(d.getDate() - 1); }
    else break;
  }
  return streak;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function switchTab(tab) {
  document.getElementById('tab-login').style.display = tab === 'login' ? 'block' : 'none';
  document.getElementById('tab-register').style.display = tab === 'register' ? 'block' : 'none';
  document.querySelectorAll('.login-tab').forEach((el, i) => {
    el.classList.toggle('active', (i === 0 && tab === 'login') || (i === 1 && tab === 'register'));
  });
}

function doLogin() {
  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  const err = document.getElementById('login-error');

  if (!email || !password) { err.textContent = 'Preencha todos os campos.'; return; }

  const users = getUsers();
  if (!users[email]) { err.textContent = 'Email n√£o encontrado.'; return; }
  if (users[email].password !== btoa(password)) { err.textContent = 'Senha incorreta.'; return; }

  err.textContent = '';
  setCurrentUser({ email, name: users[email].name });
  initApp();
}

function doRegister() {
  const name = document.getElementById('reg-name').value.trim();
  const email = document.getElementById('reg-email').value.trim();
  const password = document.getElementById('reg-password').value;
  const err = document.getElementById('reg-error');

  if (!name || !email || !password) { err.textContent = 'Preencha todos os campos.'; return; }
  if (password.length < 6) { err.textContent = 'Senha deve ter pelo menos 6 caracteres.'; return; }
  if (!/\S+@\S+\.\S+/.test(email)) { err.textContent = 'Email inv√°lido.'; return; }

  const users = getUsers();
  if (users[email]) { err.textContent = 'Este email j√° est√° cadastrado.'; return; }

  users[email] = { name, password: btoa(password) };
  saveUsers(users);

  err.textContent = '';
  setCurrentUser({ email, name });
  initApp();
}

function doLogout() {
  clearCurrentUser();
  document.getElementById('screen-app').classList.remove('active');
  document.getElementById('screen-login').classList.add('active');
  document.getElementById('login-email').value = '';
  document.getElementById('login-password').value = '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// APP INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function initApp() {
  document.getElementById('screen-login').classList.remove('active');
  document.getElementById('screen-app').classList.add('active');

  const user = getCurrentUser();
  if (!user) return;

  // Greeting
  const h = new Date().getHours();
  const greetings = ['Boa madrugada', 'Bom dia', 'Boa tarde', 'Boa noite'];
  const greet = h < 5 ? greetings[0] : h < 12 ? greetings[1] : h < 18 ? greetings[2] : greetings[3];
  document.getElementById('greeting-time').textContent = greet;
  document.getElementById('greeting-name').textContent = user.name.split(' ')[0];

  // Profile
  document.getElementById('profile-avatar').textContent = user.name[0].toUpperCase();
  document.getElementById('profile-name-display').textContent = user.name;
  document.getElementById('profile-email-display').textContent = user.email;

  // Checklist date
  const now = new Date();
  const days = ['Domingo','Segunda','Ter√ßa','Quarta','Quinta','Sexta','S√°bado'];
  const months = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
  document.getElementById('checklist-date').textContent =
    `${days[now.getDay()]}, ${now.getDate()} de ${months[now.getMonth()]}`;

  navigate('home');
  restoreChecks();
  updateDashboard();
  buildStreakGrid();
  updateProgressPage();
  requestNotificationPermission();
}

function restoreChecks() {
  const checks = getTodayChecks();
  document.querySelectorAll('.check-item').forEach(el => {
    const key = el.dataset.key;
    if (checks[key]) el.classList.add('done');
    else el.classList.remove('done');
  });
  updateAllCounts();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function navigate(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.getElementById('nav-' + page).classList.add('active');
  if (page === 'progresso') updateProgressPage();
}

function goToChecklist(pilar) {
  navigate('checklist');
  setTimeout(() => {
    const el = document.getElementById('section-' + pilar);
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHECKLIST LOGIC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function toggleCheck(el) {
  const key = el.dataset.key;
  const isDone = el.classList.toggle('done');
  setCheck(key, isDone);
  updateAllCounts();
  updateDashboard();

  if (isDone) showToast('‚úì Protocolo registrado');
}

function updateAllCounts() {
  const checks = getTodayChecks();
  Object.entries(PILARES).forEach(([pilar, { total }]) => {
    let done = 0;
    for (let i = 0; i < total; i++) {
      if (checks[`${pilar}-${i}`]) done++;
    }
    document.getElementById('count-' + pilar).textContent = `${done}/${total}`;
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD UPDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function updateDashboard() {
  const checks = getTodayChecks();
  const streak = getStreak();

  // Header streak
  document.getElementById('header-streak-count').textContent = streak;

  // Ring
  const done = Object.values(checks).filter(Boolean).length;
  const pct = Math.round((done / TOTAL_CHECKS) * 100);
  const circumference = 220;
  const offset = circumference - (circumference * pct / 100);
  document.getElementById('ring-fill').style.strokeDashoffset = offset;
  document.getElementById('ring-pct').textContent = pct + '%';

  const scoreMessages = [
    [0, 'Inicie seu dia', 'Complete os protocolos de hoje para subir sua pontua√ß√£o.'],
    [25, 'Bom come√ßo', 'Continue ‚Äî cada protocolo conta para a sua performance.'],
    [50, 'Na metade', 'Voc√™ est√° no caminho certo. N√£o pare agora.'],
    [75, 'Quase l√°', 'Faltam poucos protocolos para um dia completo.'],
    [100, 'Dia perfeito üî•', 'Todos os protocolos conclu√≠dos. Isso √© disciplina real.'],
  ];
  const msg = scoreMessages.reverse().find(([min]) => pct >= min) || scoreMessages[0];
  document.getElementById('score-title').textContent = msg[1];
  document.getElementById('score-sub').textContent = msg[2];

  // Pilar cards
  Object.entries(PILARES).forEach(([pilar, { total }]) => {
    let pilarDone = 0;
    for (let i = 0; i < total; i++) {
      if (checks[`${pilar}-${i}`]) pilarDone++;
    }
    const pilarPct = Math.round((pilarDone / total) * 100);
    document.getElementById('prog-' + pilar).style.width = pilarPct + '%';
    document.getElementById('done-' + pilar).textContent = `${pilarDone}/${total}`;
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STREAK GRID
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function buildStreakGrid() {
  const grid = document.getElementById('streak-grid');
  grid.innerHTML = '';
  const days = ['D','S','T','Q','Q','S','S'];
  const today = new Date();

  for (let i = 6; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(today.getDate() - i);
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const score = getDayScore(key);
    const isToday = i === 0;
    const isDone = score >= 60;

    const el = document.createElement('div');
    el.className = `streak-day${isDone ? ' done' : ''}${isToday ? ' today' : ''}`;
    el.innerHTML = `<span class="streak-day-label">${days[d.getDay()]}</span><div class="streak-day-dot"></div>`;
    grid.appendChild(el);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROGRESS PAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function updateProgressPage() {
  const streak = getStreak();
  const today = new Date();

  // Stats
  document.getElementById('stat-streak').textContent = streak;

  // Count completed days (score >= 60) in last 30 days
  let totalDone = 0;
  let weeklyScores = [];
  for (let i = 13; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(today.getDate() - i);
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const score = getDayScore(key);
    if (score >= 60) totalDone++;
    weeklyScores.push({ score, isToday: i === 0, day: ['D','S','T','Q','Q','S','S'][d.getDay()] });
  }
  document.getElementById('stat-total').textContent = totalDone;

  // Weekly avg (last 7 days)
  const last7 = weeklyScores.slice(-7);
  const avg = Math.round(last7.reduce((a, b) => a + b.score, 0) / 7);
  document.getElementById('stat-avg').textContent = avg + '%';

  // Chart
  const chartBars = document.getElementById('chart-bars');
  chartBars.innerHTML = '';
  weeklyScores.forEach(({ score, isToday, day }) => {
    const wrap = document.createElement('div');
    wrap.className = 'chart-bar-wrap';
    const bar = document.createElement('div');
    bar.className = `chart-bar${isToday ? ' today' : ''}`;
    bar.style.height = Math.max(score, 4) + '%';
    const label = document.createElement('div');
    label.className = 'chart-day-label';
    label.textContent = day;
    wrap.appendChild(bar);
    wrap.appendChild(label);
    chartBars.appendChild(wrap);
  });

  // Pilar breakdown (last 7 days)
  const pilarBreakdown = {};
  Object.keys(PILARES).forEach(p => pilarBreakdown[p] = { done: 0, total: 0 });

  for (let i = 6; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(today.getDate() - i);
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const checks = getDayChecks(key);
    Object.entries(PILARES).forEach(([pilar, { total }]) => {
      pilarBreakdown[pilar].total += total;
      for (let j = 0; j < total; j++) {
        if (checks[`${pilar}-${j}`]) pilarBreakdown[pilar].done++;
      }
    });
  }

  Object.entries(pilarBreakdown).forEach(([pilar, { done, total }]) => {
    const pct = total > 0 ? Math.round((done / total) * 100) : 0;
    document.getElementById('bd-' + pilar).style.width = pct + '%';
    document.getElementById('bdp-' + pilar).textContent = pct + '%';
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function toggleSetting(key, btn) {
  btn.classList.toggle('on');
  const user = getCurrentUser();
  if (!user) return;
  const data = getUserData(user.email);
  if (!data.settings) data.settings = {};
  data.settings[key] = btn.classList.contains('on');
  saveUserData(user.email, data);
}

function clearData() {
  if (!confirm('Isso vai apagar todo o seu hist√≥rico de protocolos. Tem certeza?')) return;
  const user = getCurrentUser();
  if (!user) return;
  const db = getDB();
  if (db.userData && db.userData[user.email]) {
    db.userData[user.email].checks = {};
    saveDB(db);
  }
  restoreChecks();
  updateDashboard();
  buildStreakGrid();
  updateProgressPage();
  showToast('Dados resetados');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFICATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function requestNotificationPermission() {
  if ('Notification' in window && Notification.permission === 'default') {
    Notification.requestPermission();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

(function boot() {
  const user = getCurrentUser();
  if (user) {
    initApp();
  } else {
    document.getElementById('screen-login').classList.add('active');
  }
})();
</script>
</body>
</html>
